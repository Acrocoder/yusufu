<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boutique Credit Manager</title>
    <style>
        /* --- Basic Mobile-First Styling --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 650px;
            /* Default for mobile */
            margin: 0 auto;
            padding: 10px;
        }

        h1,
        h2 {
            color: #0d47a1;
            text-align: center;
        }

        .card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
            padding: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4b4f56;
        }

        input[type="text"],
        input[type="tel"],
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #dddfe2;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }

        button {
            background-color: #0d47a1;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #0a3570;
        }

        button.record-payment-btn {
            background-color: #28a745;
            margin-top: 10px;
        }

        button.record-payment-btn:hover {
            background-color: #218838;
        }

        .loan-item {
            border-left: 5px solid #0d47a1;
            padding: 10px 15px;
            margin-bottom: 12px;
            background: #f9f9f9;
            border-radius: 0 6px 6px 0;
        }

        .loan-item.paid {
            border-left-color: #28a745;
            opacity: 0.8;
        }

        .loan-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .loan-details {
            font-size: 0.9em;
            color: #606770;
        }

        .loan-amount {
            font-weight: bold;
            color: #333;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
            float: right;
        }

        .status-badge.active {
            background-color: #007bff;
        }

        .status-badge.paid {
            background-color: #28a745;
        }

        /* --- Summary Grid Styling (Mobile) --- */
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* 2x2 grid on mobile */
            gap: 10px;
        }

        .summary-item {
            background-color: #eef2f7;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-item p {
            margin: 0;
            font-size: 0.9em;
            color: #606770;
        }

        .summary-item strong {
            display: block;
            font-size: 1.5em;
            color: #0d47a1;
            margin-top: 5px;
        }

        .tab-button {
            background-color: #e4e6eb;
            color: #050505;
            margin-right: 5px;
            margin-bottom: 5px;
            display: inline-block;
            width: auto;
            padding: 10px 15px;
            border-radius: 6px;
        }

        .tab-button.active {
            background-color: #0d47a1;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* --- Responsive Styles for Desktops and Laptops --- */
        @media (min-width: 768px) {
            .container {
                max-width: 1000px;
                /* Wider container on desktop */
                padding: 20px;
            }

            /* Summary becomes a single row */
            .summary-grid {
                grid-template-columns: 1fr 1fr 1fr 1fr;
                /* 1x4 grid on desktop */
            }

            /* Loan items become more compact with flexbox */
            .loan-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .loan-main-info {
                flex-grow: 1;
            }

            .loan-actions {
                text-align: right;
                margin-left: 20px;
                white-space: nowrap;
                /* Prevents button from wrapping */
            }

            .loan-actions p {
                margin: 0 0 5px 0;
            }

            .loan-actions .record-payment-btn {
                margin-top: 0;
                width: auto;
                /* Button is no longer full-width */
                padding: 8px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Boutique Credit Manager</h1>

        <!-- Navigation Tabs -->
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="tab-button active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab-button" onclick="showTab('register-loan')">Register Loan</button>
            <button class="tab-button" onclick="showTab('paid-loans')">Paid History</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Quick Summary Card -->
            <div class="card">
                <h2>Quick Summary</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <p>Total Owed</p>
                        <strong id="total-owed">0 RWF</strong>
                    </div>
                    <div class="summary-item">
                        <p>Active Loans</p>
                        <strong id="active-count">0</strong>
                    </div>
                    <div class="summary-item">
                        <p>Loans Given Today</p>
                        <strong id="today-total">0 RWF</strong>
                    </div>
                    <div class="summary-item">
                        <p>Loans This Month</p>
                        <strong id="month-total">0 RWF</strong>
                    </div>
                </div>
            </div>

            <!-- Active Loans Card -->
            <div class="card">
                <h2>Active Loans</h2>
                <div id="active-loan-list">
                    <!-- Active loans will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Register Loan Tab -->
        <div id="register-loan" class="tab-content">
            <div class="card">
                <h2>Register New Loan</h2>
                <form id="loan-form">
                    <div class="form-group">
                        <label for="person-name">Full Name</label>
                        <input type="text" id="person-name" placeholder="e.g., Jean Mugabo" required>
                    </div>
                    <div class="form-group">
                        <label for="person-phone">Phone Number</label>
                        <input type="tel" id="person-phone" placeholder="e.g., 0788123456" required>
                    </div>
                    <div class="form-group">
                        <label for="loan-amount">Total Loan Amount (RWF)</label>
                        <input type="number" id="loan-amount" placeholder="e.g., 25000" required>
                    </div>
                    <button type="submit">Register Loan</button>
                </form>
            </div>
        </div>

        <!-- Paid Loans Tab -->
        <div id="paid-loans" class="tab-content">
            <div class="card">
                <h2>Completed Payments</h2>
                <div id="paid-loan-list">
                    <!-- Paid loans will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA MANAGEMENT ---
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function loadData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : [];
        }

        let loans = loadData('loans');

        // --- UI & LOGIC ---

        // Show/Hide Tabs
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                displayDashboard();
            } else if (tabName === 'paid-loans') {
                displayPaidLoans();
            }
        }

        // --- LOAN MANAGEMENT ---
        document.getElementById('loan-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const newLoan = {
                id: Date.now().toString(),
                name: document.getElementById('person-name').value,
                phone: document.getElementById('person-phone').value,
                originalAmount: parseFloat(document.getElementById('loan-amount').value),
                remainingBalance: parseFloat(document.getElementById('loan-amount').value),
                dateGiven: new Date().toISOString().split('T')[0], // YYYY-MM-DD format
                status: 'active' // 'active' or 'paid'
            };
            loans.push(newLoan);
            saveData('loans', loans);
            alert('Loan registered successfully!');
            this.reset();

            // Go back to dashboard to see the new loan
            document.querySelector('.tab-button[onclick="showTab(\'dashboard\')"]').click();
        });

        function displayDashboard() {
            updateSummary();
            displayActiveLoans();
        }

        function updateSummary() {
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const activeLoans = loans.filter(loan => loan.status === 'active');

            const totalOwed = activeLoans.reduce((sum, loan) => sum + loan.remainingBalance, 0);
            const activeCount = activeLoans.length;

            const todayLoans = loans.filter(loan => loan.dateGiven === todayStr);
            const todayTotal = todayLoans.reduce((sum, loan) => sum + loan.originalAmount, 0);

            const monthLoans = loans.filter(loan => {
                const loanDate = new Date(loan.dateGiven);
                return loanDate.getMonth() === currentMonth && loanDate.getFullYear() === currentYear;
            });
            const monthTotal = monthLoans.reduce((sum, loan) => sum + loan.originalAmount, 0);

            document.getElementById('total-owed').textContent = `${totalOwed.toLocaleString()} RWF`;
            document.getElementById('active-count').textContent = activeCount;
            document.getElementById('today-total').textContent = `${todayTotal.toLocaleString()} RWF`;
            document.getElementById('month-total').textContent = `${monthTotal.toLocaleString()} RWF`;
        }

        function displayActiveLoans() {
            const loanList = document.getElementById('active-loan-list');
            loanList.innerHTML = ''; // Clear current list

            const activeLoans = loans.filter(loan => loan.status === 'active');

            if (activeLoans.length === 0) {
                loanList.innerHTML = '<p>No active loans at the moment.</p>';
                return;
            }

            activeLoans.forEach(loan => {
                const loanItem = document.createElement('div');
                loanItem.className = 'loan-item';

                // New structure for responsive layout
                loanItem.innerHTML = `
                <div class="loan-main-info">
                    <div class="loan-name">
                        ${loan.name}
                        <span class="status-badge active">OWES</span>
                    </div>
                    <div class="loan-details">
                        <p>Phone: ${loan.phone}</p>
                        <p>Original Amount: <span class="loan-amount">${loan.originalAmount.toLocaleString()} RWF</span></p>
                    </div>
                </div>
                <div class="loan-actions">
                    <p><strong>Remaining: <span style="color: #c0392b;">${loan.remainingBalance.toLocaleString()} RWF</span></strong></p>
                    <button class="record-payment-btn" onclick="recordPayment('${loan.id}')">Record Payment</button>
                </div>
            `;
                loanList.appendChild(loanItem);
            });
        }

        function displayPaidLoans() {
            const loanList = document.getElementById('paid-loan-list');
            loanList.innerHTML = ''; // Clear current list

            const paidLoans = loans.filter(loan => loan.status === 'paid');

            if (paidLoans.length === 0) {
                loanList.innerHTML = '<p>No paid loans yet.</p>';
                return;
            }

            paidLoans.sort((a, b) => new Date(b.dateGiven) - new Date(a.dateGiven));

            paidLoans.forEach(loan => {
                const loanItem = document.createElement('div');
                loanItem.className = 'loan-item paid';
                loanItem.innerHTML = `
                <div class="loan-name">
                    ${loan.name}
                    <span class="status-badge paid">PAID</span>
                </div>
                <div class="loan-details">
                    <p>Phone: ${loan.phone}</p>
                    <p>Total Loan: <span class="loan-amount">${loan.originalAmount.toLocaleString()} RWF</span></p>
                    <p>Loan Date: ${new Date(loan.dateGiven).toLocaleDateString()}</p>
                </div>
            `;
                loanList.appendChild(loanItem);
            });
        }

        function recordPayment(loanId) {
            const loan = loans.find(l => l.id === loanId);
            if (!loan) return;

            const amountStr = prompt(`Enter payment amount for ${loan.name}:\n(Remaining: ${loan.remainingBalance.toLocaleString()} RWF)`);
            if (amountStr === null || amountStr === "") return;

            const paymentAmount = parseFloat(amountStr);
            if (isNaN(paymentAmount) || paymentAmount <= 0) {
                alert("Invalid amount. Please enter a positive number.");
                return;
            }

            loan.remainingBalance -= paymentAmount;
            if (loan.remainingBalance <= 0) {
                loan.remainingBalance = 0;
                loan.status = 'paid';
                alert(`Full payment of ${paymentAmount.toLocaleString()} RWF recorded. Loan is now marked as PAID.`);
            } else {
                alert(`Payment of ${paymentAmount.toLocaleString()} RWF recorded. Remaining balance is ${loan.remainingBalance.toLocaleString()} RWF.`);
            }

            saveData('loans', loans);

            document.querySelector('.tab-button[onclick="showTab(\'dashboard\')"]').click();
        }

        // --- INITIALIZE ---
        displayDashboard();

    </script>

</body>

</html>